var usinApp=angular.module("usinApp",["ngRoute","ngSanitize","usinNgHelpers","dndLists","ngMaterial","ngAnimate","ui.select"],["$httpProvider",function(a){a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8",a.defaults.transformRequest=[function(a){return angular.isObject(a)&&"[object File]"!==String(a)?usinHelpers.serializeObject(a):a}]}]).value("options",{}).config(["$routeProvider","$locationProvider","$mdThemingProvider","$animateProvider","$mdDateLocaleProvider",function(a,b,c,d,e){var f=window.USIN.viewsURL;b.html5Mode(!1),a.when("/",{controller:"UsinMainCtrl",templateUrl:f+"/main.html"}).when("/user/:userId",{controller:"UsinProfileCtrl",templateUrl:f+"/profile.html"}).otherwise({redirectTo:"/"}),c.theme("usin").primaryPalette("teal").accentPalette("blue-grey"),c.setDefaultTheme("usin"),d.classNameFilter(/((^md-)|(usin-animate)).*/),e.formatDate=function(a){var b=window.USIN.months;return b[a.getMonth()]+" "+a.getDate()+", "+a.getFullYear()}}]).run(["options",function(a){var b=window.USIN,c=["usersPerPage","orderBy","order"];for(var d in b)b.hasOwnProperty(d)&&-1===c.indexOf(d)&&(a[d]=b[d]);a.userQuery={usersPerPage:b.usersPerPage,orderBy:b.orderBy,order:b.order}}]);angular.module("usinApp").filter("displayedFields",function(){return function(a){for(var b=[],c=0,d=a.length;d>c;c++){var e=a[c];e.show&&!e.hideOnTable&&b.push(e)}return b}}).filter("tableFields",function(){return function(a){for(var b=[],c=0,d=a.length;d>c;c++){var e=a[c];e.hideOnTable||b.push(e)}return b}}).filter("displayedFieldsIds",function(){return function(a){var b=[];return angular.forEach(a,function(a,c){a.show&&b.push(a.id)}),b}}).filter("fieldIds",function(){return function(a){var b=[];return angular.forEach(a,function(a,c){b.push(a.id)}),b}}).filter("pluckByKey",function(){return function(a,b){var c=[];return angular.forEach(a,function(a,d){c.push(a[b])}),c}}).filter("fieldById",function(){return function(a,b){var c={};return angular.forEach(a,function(a,d){a.id===b&&(c=a)}),c}}).filter("previewOperator",["options",function(a){return function(b,c){var d=a.filterOperators;if(d[c])for(var e in d[c])if(d[c][e].key===b)return d[c][e].val;return b}}]).filter("previewCondition",["options","UsinDate",function(a,b){return function(c){if(-1!==["notnull","isnull","isset","notset"].indexOf(c.operator))return"";if("date"==c.type)return-1!==["equals","smaller","bigger"].indexOf(c.operator)?b.dateStringToPrettyString(c.condition):c.condition+" "+a.strings.daysAgo;if(-1!==a.optionFieldTypes.indexOf(c.type)){var d=c.options;for(var e in d)if(d[e].key===c.condition)return d[e].val}return c.condition}}]).filter("fieldsByType",function(){return function(a,b){for(var c=[],d=0,e=a.length;e>d;d++)a[d].fieldType&&a[d].fieldType===b&&c.push(a[d]);return c}}).filter("operatorsByField",["$filter",function(a){return function(a,b){var c=[];return b.filter.disallow_null&&(c=c.concat(["isnull","notnull","isset","notset"])),"date"==b.filter.type&&b.filter.nodaysago&&(c=c.concat(["lessthan","morethan","exactly"])),c.length?a.filter(function(a){return-1===c.indexOf(a.key)}):a}}]).filter("groupTagHtml",["$sce","options",function(a,b){var c={};return function(d){if(c[d])return c[d];var e=b.groups.filter(function(a){return a.key==d});if(e&&e.length){var f=e[0],g=a.trustAsHtml('<span class="usin-group-tag" style="background-color:#'+f.color+';">'+f.val+"</span>");return c[d]=g,g}return""}}]).filter("appliedFilters",function(){return function(a){return a.filter(function(a){return a.applied})}}),usinApp.controller("UsinBulkActionsCtrl",["$scope","options","UsinBulkActionsState","$mdDialog","$controller",function(a,b,c,d,e){a.bulkActions=c,a.strings=b.strings,a.optionsVisible=!1,a.toggleOptions=function(){a.optionsVisible=!a.optionsVisible},a.showGroupEditDialog=function(c){a.bulkActions.setAction(c),d.show({controller:"UsinGroupEditCtrl",templateUrl:b.viewsURL+"/group-edit-dialog.html",parent:angular.element(document.body),clickOutsideToClose:!0}),a.optionsVisible=!1}}]),usinApp.controller("UsinConfirmDialogCtrl",["$scope","$mdDialog","options",function(a,b,c){a.isLoading=!1,a.error="",a.strings=c.strings,a.close=function(){b.cancel()},a.callAction=function(){a.action&&!a.isLoading&&(a.isLoading=!0,a.action.call().then(function(b){a.close(),a.onSuccess&&a.onSuccess.call(this,b.data)},function(b){a.error=b.data&&b.data.error||a.strings.errorLoading,a.onError&&a.onError.call(this,b.data)})["finally"](function(){a.isLoading=!1}))}}]),usinApp.controller("UsinCreateSegmentCtrl",["$scope","$filter","$mdDialog","UsinSegments",function(a,b,c,d){a.segmentName="",a.closeDialog=function(){c.cancel()},a.saveSegment=function(){if(!a.isLoading){a.isLoading=!0;var b=d.prepareFilters(a.filters);d.saveSegment(a.segmentName,b).then(function(b){a.closeDialog(),a.updateSegments(b.data)},function(b){a.error=b.data&&b.data.error||a.strings.createSegmentError})["finally"](function(){a.isLoading=!1})}},a.doOnEnter=function(b){b.preventDefault(),a.segmentName&&a.saveSegment()}}]),usinApp.controller("UsinGroupEditCtrl",["$scope","$rootScope","options","UsinUserQuery","UsinBulkActionsState","$mdDialog",function(a,b,c,d,e,f){a.bulkActions=e,a.strings=c.strings,a.action=a.bulkActions.getAction(),a.isAddAction="add"===a.action,a.groups=c.groups,a.isLoading=!1,a.title=a.strings[a.action+"Group"];var g=1===a.bulkActions.getCount()?"UserGroupInfo":"UsersGroupInfo";a.info=a.strings[a.action+g].replace("%d",a.bulkActions.getCount()),a.cancel=function(){f.cancel()},a.apply=function(){a.isLoading=!0,d.updateGroupsBulk(a.bulkActions.getChecked(),a.selectedGroup,a.action).then(function(c){a.cancel(),b.$broadcast("groupUpdated")},function(b){a.error=b.data&&b.data.error||a.strings.groupUpdateError})["finally"](function(){a.isLoading=!1})}}]),usinApp.controller("UsinListOptionsCtrl",["$scope","$filter","options","UsinListOptionsQuery","UsinListState","UsinBulkActionsState","$usinConfirmDialog",function(a,b,c,d,e,f,g){function h(){i=b("displayedFieldsIds")(a.fields).length}a.displayed=!1,a.showMap=c.geolocationActive,a.canExportUsers=c.canExportUsers,a.canUpdateUsers=c.canUpdateUsers,a.canManageSegments=c.canManageSegments,a.bulkActions=f;var i;h(),a.toggleDisplayed=function(){a.displayed=!a.displayed},a.onCheckboxChange=function(c){c.show=!c.show;var e=b("displayedFieldsIds")(a.fields),f=e.length>i;f?(a.loading.start(),d.updateDisplayedFields(e).then(function(b){a.refreshDisplayedFields()})):(d.updateDisplayedFields(e),a.setDisplayedFields()),h()},a.onToggleView=function(){a.toggleView()},a.reorder=function(c){a.fields.splice(c,1),a.setDisplayedFields();var e=b("fieldIds")(a.fields);d.updateFieldOrder(e)},a.showConfirm=function(c){g.show(angular.extend(a.$new(!0),{title:a.strings.exportAction,content:"<p>"+a.strings.confirmExport.replace("%s",a.total.current)+"</p>",actionText:a.strings.exportAction,action:function(){return d.getExportLink(b("displayedFieldsIds")(a.fields),a.filters,e.get("order"))},onSuccess:function(a){location.href=a.export_url}}))}}]),usinApp.controller("UsinListCtrl",["$scope","UsinUserQuery","options","$filter","UsinSession","$location","UsinListState","$rootScope","UsinBulkActionsState",function(a,b,c,d,e,f,g,h,i){a.userList={page:g.get("page")||1,users:[],usersPerPage:c.userQuery.usersPerPage,orderBy:e.get("usinorderby")||c.userQuery.orderBy,order:e.get("usinorder")||c.userQuery.order},g.set("order",{orderBy:a.userList.orderBy,order:a.userList.order}),a.total=null,a.currentTotal=0;var j=function(){a.loading.start();var c=g.get("refreshCacheRequired")||!1;b.getUsers(a.userList.page,a.userList.usersPerPage,a.userList.orderBy,a.userList.order,a.filters,c).then(function(b){var c=b.data;a.loading.stop(),a.setError(""),a.total=parseInt(c.alltotal,10),a.currentTotal=parseInt(c.total,10),a.userList.users=c.users,i.setAll(d("pluckByKey")(c.users,"ID")),a.$broadcast("usinUsersChanged"),a.$emit("usinUsersChanged"),a.setTotal({all:a.total,current:a.currentTotal})},function(b){var c=b.data&&b.data.error||a.strings.errorLoading;a.loading.stop(),a.setError(c)}),g.set("refreshCacheRequired",!1)};j();a.setOrderBy=function(b){if(!a.loading.isLoading()){if(a.userList.orderBy===b)a.userList.order="DESC"===a.userList.order?"ASC":"DESC";else{var c=d("fieldById")(a.fields,b);if(c.order===!1)return;a.userList.orderBy=b,a.userList.order=c.order}e.set("usinorderby",a.userList.orderBy),e.set("usinorder",a.userList.order),g.set("order",{orderBy:a.userList.orderBy,order:a.userList.order}),a.userList.page=1,i.uncheckAll(),j()}},a.openProfile=function(a){f.path("/user/"+a.ID)},a.setUsersPerPage=function(){a.userList.page=1,i.uncheckAll(),j()},a.$on("usinFilterApplied",function(){a.userList.page=1,i.uncheckAll(),j()}),a.$on("pageChange",function(b,c){a.userList.page=c,g.set("page",c),i.uncheckAll(),j()}),a.$on("fieldsChange",function(a,b){g.set("refreshCacheRequired",!0),j()}),a.$on("groupUpdated",function(){g.set("refreshCacheRequired",!0),j()}),h.$on("usinUserUpdated",function(a){g.set("refreshCacheRequired",!0)})}]),usinApp.controller("UsinMainCtrl",["$scope","options","$filter","UsinSession","UsinLoading",function(a,b,c,d,e){a.loading=!1,a.strings=b.strings,a.listView=!0,a.filters=d.get("usinfilters")||[],a.fields=c("tableFields")(b.fields),a.filterFields=b.fields,a.groups=b.groups;var f=!1;a.setClearTotal=function(){a.total={all:0,current:0,map:null}},a.setClearTotal(),a.setDisplayedFields=function(){a.showFields=c("displayedFields")(a.fields)},a.refreshDisplayedFields=function(){f=!0,a.$broadcast("fieldsChange")},a.$on("usinUsersChanged",function(){f&&(f=!1,a.setDisplayedFields())}),a.setDisplayedFields(),a.applyFilters=function(){a.$broadcast("usinFilterApplied"),d.set("usinfilters",a.filters)},a.toggleView=function(){a.setClearTotal(),a.listView=!a.listView},a.setTotal=function(b){angular.extend(a.total,b)},a.setError=function(b){a.errorMsg=b},a.loading=e}]),usinApp.controller("UsinMapCtrl",["$scope","UsinUserQuery",function(a,b){var c=function(){a.loading.start(),b.getCoordinates(a.filters).then(function(b){var c=b.data;a.loading.stop();var d=[];if(c.length)for(var e in c)d.push({coordinates:c[e].coordinates,title:c[e].username});a.setTotal({map:c.length}),a.mapOptions={markers:d,zoom:2}},function(b){var c=b.data&&b.data.error||a.strings.errorLoading;a.loading.stop(),a.setError(c)})};c(),a.$on("usinFilterApplied",function(){c()})}]),usinApp.controller("UsinPaginationCtrl",["$scope","options","UsinListOptionsQuery",function(a,b,c){a.pages=0,a.pageOptions=b.pageOptions;var d=function(){a.userPage=a.userList.page,a.currentTotal?a.pages=Math.ceil(a.currentTotal/a.userList.usersPerPage):a.pages=0};d(),a.$on("usinUsersChanged",d),a.changePage=function(b){a.loading.isLoading()||("number"!=typeof b&&(b=parseInt(b,10)),b>=1&&b<=a.pages&&a.$emit("pageChange",b))},a.onUsersPerPageChange=function(){a.setUsersPerPage(),c.updateUsersPerPage(a.userList.usersPerPage)}}]),usinApp.controller("UsinProfileEditableFieldCtrl",["$scope","$rootScope","options","UsinUserQuery",function(a,b,c,d){a.loading=!1,a.errorMsg="",a.editing=!1,a.toggleEdit=function(){a.editing=!a.editing},a.updateField=function(){a.loading||(a.loading=!0,a.errorMsg="",d.updateUserField(a.user.ID,a.field.id,a.user[a.field.id]).then(function(c){a.loading=!1,a.editing=!1,b.$broadcast("usinUserUpdated")},function(b){a.loading=!1,a.errorMsg=b.data&&b.data.error||c.strings.fieldUpdateError}))}}]),usinApp.controller("UsinProfileGroupsCtrl",["$scope","options","UsinUserQuery","$rootScope",function(a,b,c,d){var e,f;a.editing=!1,a.allGroups=b.groups,a.groupLoading=!1,a.toggleEdit=function(){a.editing=!a.editing},a.userHasGroup=function(b){return a.user?-1!==a.user.user_groups.indexOf(b):void 0},e=function(b){a.user.user_groups.push(b)},f=function(b){var c=a.user.user_groups.indexOf(b);c>-1&&a.user.user_groups.splice(c,1)},a.toggleGroup=function(b){a.userHasGroup(b)?f(b):e(b)},a.updateGroups=function(){a.groupLoading||(a.groupLoading=!0,c.updateGroups(a.user.ID,a.user.user_groups).then(function(b){a.groupLoading=!1,a.editing=!1,d.$broadcast("usinUserUpdated")},function(c){a.groupLoading=!1,a.groupErrorMsg=c.data&&c.data.error||b.strings.groupUpdateError}))}}]),usinApp.controller("UsinProfileNotesCtrl",["$scope","options","UsinUserQuery","$rootScope",function(a,b,c,d){a.noteContent="",a.noteLoading=!1,a.noteErrorMsg="",a.startNoteLoading=function(){a.noteLoading=!0},a.stopNoteLoading=function(){a.noteLoading=!1},a.doOnError=function(c){a.stopNoteLoading(),a.noteErrorMsg=c.data&&c.data.error||b.strings.noteError},a.updateNotes=function(b){a.user.notes=b},a.addNote=function(){!a.noteLoading&&a.noteContent&&(a.startNoteLoading(),c.addNote(a.user.ID,a.noteContent).then(function(b){var c=b.data;a.stopNoteLoading(),a.updateNotes(c.notes),d.$broadcast("usinUserUpdated"),a.noteContent=""},a.doOnError))},a.deleteNote=function(b,e){a.noteLoading||(a.startNoteLoading(),c.deleteNote(b).then(function(b){b.data;a.stopNoteLoading(),a.user.notes.splice(e,1),d.$broadcast("usinUserUpdated")},a.doOnError))}}]),usinApp.controller("UsinProfileCtrl",["$scope","$routeParams","UsinUserQuery","options",function(a,b,c,d){a.customTemplates=d.customTemplates;a.strings=d.strings,a.loading=!0,a.fields=d.unorderedFields,a.canUpdateUsers=d.canUpdateUsers,c.getUser(b.userId).then(function(b){a.loading=!1,a.user=b.data,d.geolocationActive&&a.user.coordinates&&a.user.coordinates.lng&&a.user.coordinates.lat&&(a.mapOptions={center:{lng:a.user.coordinates.lng,lat:a.user.coordinates.lat},centerMarker:!0,zoom:6})},function(b){a.loading=!1,a.errorMsg=b.data&&b.data.error||a.strings.errorLoading}),a.isFieldEditable=function(a){return-1!==d.editableFields.indexOf(a)}}]),usinApp.controller("UsinSegmentsCtrl",["$scope","$rootScope","options","$mdDialog","$usinConfirmDialog","UsinSegments","$filter",function(a,b,c,d,e,f,g){a.updateSegments=function(b){a.segments=f.setup(b)},a.optionsVisible=!1,a.updateSegments(c.segments),a.toggleOptions=function(){a.optionsVisible=!a.optionsVisible},a.openSegmentDialog=function(){d.show({scope:a,preserveScope:!0,controller:"UsinCreateSegmentCtrl",templateUrl:c.viewsURL+"/create-segment-dialog.html",parent:angular.element(document.body),clickOutsideToClose:!0}),a.optionsVisible=!1},a.deleteSegment=function(b){e.show(angular.extend(a.$new(!0),{title:a.strings.deleteSegment,content:"<p>"+a.strings.confirmDeleteSegment.replace("%s",b.name)+"</p>",actionText:a.strings.deleteSegment,action:function(){return f.deleteSegment(b.id)},onSuccess:function(b){a.updateSegments(b)}}))},a.applySegment=function(c){b.$broadcast("usinApplySegment",angular.copy(c.filters)),a.toggleOptions()}}]),usinApp.directive("usinBulkActions",["options","$filter",function(a,b){return{restrict:"EAC",templateUrl:a.viewsURL+"/bulk-actions.html",replace:!0,controller:"UsinBulkActionsCtrl"}}]),usinApp.directive("usinDateFilter",["options","UsinDate","UsinFields",function(a,b,c){return{restrict:"EA",templateUrl:a.viewsURL+"/date-pick.html",replace:!0,scope:{condition:"=",operator:"=",by:"="},link:function(c,d,e){c.strings=a.strings,c.date=new Date,c.updateDate=function(){c.condition=b.dateObjectToString(c.date)},c.isDateOperator=function(a){return-1!==["equals","smaller","bigger"].indexOf(a)},c.updateDate=function(){c.condition=b.dateObjectToString(c.date)},c.updateDaysAgo=function(){c.condition=c.daysAgo},c.setDefaultValue=function(){c.isDateOperator(c.operator)?c.updateDate():c.condition=null},c.applySetValue=function(){c.isDateOperator(c.operator)?c.date=b.dateStringToObject(c.condition):c.daysAgo=c.condition},c.condition?c.applySetValue():c.setDefaultValue(),c.$watch("by",function(a,b){a!=b&&(c.date=new Date)}),c.$watch("operator",function(a,b){var d=c.isDateOperator(b),e=c.isDateOperator(a);d^e&&c.setDefaultValue()}),c.$watch("condition",function(a,b){c.isDateOperator(c.operator)||a===c.daysAgo||c.applySetValue()})}}}]),usinApp.directive("usinFilter",["options","$filter",function(a,b){return{restrict:"EA",templateUrl:a.viewsURL+"/filter.html",replace:!0,scope:{fields:"=",filters:"=",loading:"=",broadcastChange:"&"},link:function(c,d,e){c.operators=a.filterOperators,c.strings=a.strings,c.filtersPending=!1,c.fieldOperators=[],c.addFilter=function(){c.filtersPending||c.loading.isLoading()||(c.filters.push({}),c.filtersPending=!0)},c.$on("usinApplySegment",function(a,b){c.filters.splice(0,c.filters.length),Array.prototype.push.apply(c.filters,b),c.broadcastChange(),c.filtersPending=!1}),c.doOnFieldSelected=function(a){a.condition=null;var d=b("fieldById")(c.fields,a.by),e=d.filter.type;a.type=e,c.isOptionField&&(a.options=d.filter.options),a.label=d.name,c.fieldOperators=b("operatorsByField")(c.operators[e],d),a.operator=c.fieldOperators[0].key},c.applyFilter=function(a){var b=null===a.condition||""===a.condition;(!b||c.isNullOperator(a.operator))&&(a.applied=!0,a.editing=!1,c.broadcastChange(),c.filtersPending=!1)},c.remove=function(a){if(!c.loading.isLoading()){var b=c.filters.indexOf(a);c.filters.splice(b,1),(a.applied||a.editing)&&c.broadcastChange(),(a.editing&&c.filtersPending||!a.applied)&&(c.filtersPending=!1)}},c.edit=function(a){if(!c.filtersPending){var d=b("fieldById")(c.fields,a.by);c.fieldOperators=b("operatorsByField")(c.operators[d.filter.type],d),a.applied=!1,a.editing=!0,c.filtersPending=!0}},c.isNullOperator=function(a){return-1!==["isnull","notnull","isset","notset"].indexOf(a)},c.isOptionField=function(b){return-1!==a.optionFieldTypes.indexOf(b)},c.isTextField=function(b){return-1!==a.textFieldTypes.indexOf(b)}}}}]),usinApp.directive("usinListOptions",["options","UsinListOptionsQuery","$filter",function(a,b,c){return{restrict:"EAC",templateUrl:a.viewsURL+"/list-options.html",replace:!0,controller:"UsinListOptionsCtrl"}}]),usinApp.directive("usinListView",["options","$filter",function(a,b){return{restrict:"EAC",templateUrl:a.viewsURL+"/list.html",replace:!0,controller:"UsinListCtrl"}}]),usinApp.directive("usinMap",["UsinMapHelper",function(a){return{restrict:"EA",replace:!1,scope:{mapOptions:"="},link:function(b,c,d,e){function f(){if(!h){var c=a.createMap(j,b.mapOptions);h=c.map,c.mc&&(i=c.mc)}h._onResize(),jQuery(j).addClass("usin-map-loaded")}function g(){var c=b.mapOptions.markers;c&&(i=i?a.refreshMarkers(h,i,c):a.addMarkers(h,c))}var h,i,j=document.createElement("div");j.className="usin-map",j.id="usin-map",c.prepend(j),b.mapOptions&&f(),b.$watch("mapOptions",function(a){a&&!h?f():a&&h&&g()})}}}]),usinApp.directive("usinProfileEditableField",["options",function(a){return{restrict:"EAC",templateUrl:a.viewsURL+"/profile-editable-field.html",replace:!0,controller:"UsinProfileEditableFieldCtrl"}}]),usinApp.directive("usinProfileGroups",["options",function(a){return{restrict:"EAC",templateUrl:a.viewsURL+"/profile-groups.html",replace:!0,controller:"UsinProfileGroupsCtrl"}}]),usinApp.directive("usinProfileNotes",["options",function(a){return{restrict:"EAC",templateUrl:a.viewsURL+"/profile-notes.html",replace:!0,controller:"UsinProfileNotesCtrl"}}]),usinApp.directive("usinSearchSelect",["options","$filter",function(a,b){return{restrict:"EAC",templateUrl:a.viewsURL+"/search-select.html",replace:!0,require:"^ngModel",scope:{usinOptions:"=",usinOptionKey:"@",usinOptionVal:"@",usinPlaceholder:"@",ngModel:"=",ngChange:"&"},link:function(b,c,d){b.usinOptionKey||(b.usinOptionKey="key"),b.usinOptionVal||(b.usinOptionVal="val"),b.usinPlaceholder||(b.usinPlaceholder=a.strings.select)}}}]),usinApp.directive("usinSegments",["options","$filter",function(a,b){return{restrict:"EAC",templateUrl:a.viewsURL+"/segments.html",replace:!0,controller:"UsinSegmentsCtrl"}}]),usinApp.factory("UsinBulkActionsState",function(){var a=[],b=[],c="",d=[],e=!0;return{isAllChecked:function(){return 0===this._getDiff().length},isAllIndeterminate:function(){var a=this._getDiff();return a.length!==b.length&&0!==a.length},isAnyChecked:function(){return a.length>0},_getDiff:function(){return e&&(d=b.filter(function(b){return a.indexOf(b)<0}),e=!1),d},toggleAll:function(){this.isAllChecked()?this.uncheckAll():this.checkAll(),e=!0},uncheckAll:function(){a=[],e=!0},checkAll:function(){a=b.slice(),e=!0},isChecked:function(b){return-1!==a.indexOf(b)},toggle:function(b){if(this.isChecked(b)){var c=a.indexOf(b);a.splice(c,1)}else a.push(b);e=!0},getChecked:function(){return a},getCount:function(){return a.length},setAction:function(a){c=a},getAction:function(){return c},resetAction:function(){c=""},setAll:function(c){b=c,a=a.filter(function(a){return b.indexOf(a)>=0}),e=!0}}}),usinApp.factory("$usinConfirmDialog",["options","$mdDialog",function(a,b){return{show:function(c){return b.show({scope:c,controller:"UsinConfirmDialogCtrl",templateUrl:a.viewsURL+"/confirm-dialog.html",parent:angular.element(document.body),clickOutsideToClose:!0})}}}]),usinApp.factory("UsinDate",["options",function(a){return{dateStringToObject:function(a){var b={},c=a.split("-");if(3===c.length){var d=parseInt(c[0],10),e=parseInt(c[1],10),f=parseInt(c[2],10);return new Date(d,e-1,f)}return b},dateObjectToString:function(a){return a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()},dateStringToPrettyString:function(b){var c=this.dateStringToObject(b);return a.months[c.getMonth()]+" "+c.getDate()+", "+c.getFullYear()}}}]),usinApp.factory("UsinFields",["options",function(a){return{getField:function(b){var c=null;return angular.forEach(a.fields,function(a,d){a.id===b&&(c=a)}),c},getFilterOption:function(a,b){var c=this.getField(a);return c&&c.filter&&c.filter[b]?c.filter[b]:void 0}}}]),usinApp.factory("UsinListOptionsQuery",["options","$http","UsinRequestDataPrepare",function(a,b,c){var d=function(c,d){var e=usinHelpers.url.addParam(a.ajaxURL,"action","usin_update_list_opion"),f={option_key:c,option_val:d,nonce:a.nonce};return b({method:"post",url:e,data:f})};return{updateDisplayedFields:function(a){return d("fields",a)},updateFieldOrder:function(a){return d("field_order",a)},updateUsersPerPage:function(a){d("users_per_page",a)},getExportLink:function(d,e,f){var g={filters:e,nonce:a.nonce,action:"usin_export_link"};return g.fields=angular.toJson(d),f.orderBy&&(g.orderby=f.orderBy),f.order&&(g.order=f.order),e&&e.length&&(g.filters=c.filters(e)),b({method:"get",url:a.ajaxURL,params:g})}}}]),usinApp.factory("UsinListState",function(){var a={};return{isStateSaved:function(b){return a[b]?!0:!1},get:function(b){return a[b]?a[b]:null},set:function(b,c){a[b]=c}}}),usinApp.factory("UsinLoading",function(){var a=!1;return{loading:!1,isLoading:function(){return a},start:function(){a=!0},stop:function(){a=!1}}}),usinApp.factory("UsinMapHelper",["$location","options","UsinMapLayers",function(a,b,c){return{createMap:function(a,b){var d,e,f={};return d={center:this.getCenter(b.center),zoom:b.zoom,maxZoom:12,minZoom:2},e=L.map(a.id,d),c.getTileLayer().addTo(e),b.centerMarker&&L.marker(d.center).addTo(e),b.markers&&(f.mc=this.addMarkers(e,b.markers)),f.map=e,f},addMarkers:function(a,b){if(b){for(var c=L.markerClusterGroup({showCoverageOnHover:!1,maxClusterRadius:50}),d=this.getMarkerObjects(b),e=0,f=d.length;f>e;e++)c.addLayer(d[e]);a.addLayer(c);var g=new L.featureGroup(d);return a.fitBounds(g.getBounds(),{padding:[10,10]}),c}},getMarkerObjects:function(a){var b=[];a=this.differentiateMarkers(a);for(var c=0,d=a.length;d>c;c++){var e=a[c];if(e.coordinates){var f=e.coordinates.split(",").map(parseFloat);f&&2==f.length&&f[0]&&f[1]&&b.push(L.marker(f,{title:e.title}))}}return b},getCenter:function(a){return a&&a.lat&&a.lng?[a.lat,a.lng]:[0,0]},refreshMarkers:function(a,b,c){return markerObjects=this.getMarkerObjects(c),a.removeLayer(b),b=this.addMarkers(a,c)},differentiateMarkers:function(a){for(var b=[],c=function(a){var b=a.split(","),c=b[0],d=b[1],e=.999996,f=1.000001,g=c*(Math.random()*(f-e)+e),h=d*(Math.random()*(f-e)+e);return g+","+h},d=0,e=a.length;e>d;d++){var f=a[d],g=f.coordinates;g&&-1!==b.indexOf(g)&&(a[d].coordinates=c(g)),b.push(a[d].coordinates)}return a}}}]),usinApp.factory("UsinMapLayers",["options",function(a){return{getProtocol:function(){return a.is_ssl?"https":"http"},getTileLayer:function(){var b;return b=a.is_ssl?"https://stamen-tiles-{s}.a.ssl.fastly.net/toner/{z}/{x}/{y}@2x.png":"http://{s}.tile.stamen.com/toner/{z}/{x}/{y}@2x.png",L.tileLayer(b,{attribution:'<a href="http://stamen.com">Stamen Design</a>',subdomains:"abcd",maxZoom:20,minZoom:0})}}}]),usinApp.factory("UsinRequestDataPrepare",function(){return{filters:function(a){if(a&&a.length){filtersData=angular.copy(a);for(var b in filtersData){var c=["options","label","applied","editing"];for(var d in c){var e=c[d];e in filtersData[b]&&delete filtersData[b][e]}}return angular.toJson(filtersData)}}}}),usinApp.factory("UsinSegments",["$filter","options","$http",function(a,b,c){return{setup:function(c){return c.map(function(c){return c.filters&&c.filters.forEach(function(c){var d=a("fieldById")(b.fields,c.by);angular.equals(d,{})?c.disabled=!0:d.filter&&d.filter.options&&(c.options=d.filter.options)}),c})},prepareFilters:function(b){var c=angular.copy(a("appliedFilters")(b));return c.forEach(function(a){delete a.$$hashKey,delete a.object,delete a.options}),c},saveSegment:function(a,d){return c({method:"post",url:usinHelpers.url.addParam(b.ajaxURL,"action","usin_save_segment"),data:{filters:angular.toJson(d),name:a,nonce:b.nonce,action:"usin_save_segment"}})},deleteSegment:function(a){return c({method:"post",url:usinHelpers.url.addParam(b.ajaxURL,"action","usin_delete_segment"),data:{segment_id:a,nonce:b.nonce}})}}}]),usinApp.factory("UsinSession",["$window",function(a){return{get:function(b){if(!a.sessionStorage)return null;var c=sessionStorage[b];return c&&(c=angular.fromJson(c)),c},set:function(b,c){a.sessionStorage&&(sessionStorage[b]=angular.toJson(c))}}}]),usinApp.factory("UsinUserQuery",["options","$http","$cacheFactory","UsinRequestDataPrepare",function(a,b,c,d){var e=c("lru",{capacity:20});return{getUsers:function(c,f,g,h,i,j){var k=a.ajaxURL,l={action:"usin_get_users",page:c,users_per_page:f,orderby:g,order:h,nonce:a.nonce};return i&&i.length&&(l.filters=d.filters(i)),j&&e.removeAll(),b({method:"get",url:k,params:l,cache:e})},getUser:function(c){var d=a.ajaxURL,f={action:"usin_get_user_data",nonce:a.nonce,userid:c};return b({method:"get",url:d,params:f,cache:e})},getCoordinates:function(c){var f=a.ajaxURL,g={action:"usin_get_coordinates",nonce:a.nonce};return c&&c.length&&(g.filters=d.filters(c)),b({method:"get",url:f,params:g,cache:e})},updateGroups:function(c,d){var e=a.ajaxURL,f={action:"usin_update_groups",nonce:a.nonce,user:c,groups:d};return b({method:"post",url:e,data:f})},updateGroupsBulk:function(c,d,e){var f=a.ajaxURL,g={action:"usin_update_groups_bulk",nonce:a.nonce,users:c,groupId:d,bulkAction:e};return b({method:"post",url:f,data:g})},addNote:function(c,d){var e=a.ajaxURL,f={action:"usin_add_note",nonce:a.nonce,user:c,note:d};return b({method:"post",url:e,data:f})},deleteNote:function(c){var d=a.ajaxURL,e={action:"usin_delete_note",nonce:a.nonce,note_id:c};return b({method:"post",url:d,data:e})},updateUserField:function(c,d,e){var f=a.ajaxURL,g={action:"usin_update_user_field",nonce:a.nonce,user:c,field_id:d,field_value:e};return b({method:"post",url:f,data:g})}}}]);
//# sourceMappingURL=user-list.min.js.map