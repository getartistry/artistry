!function(a){var b="",c="",d="",e="",f="",g={init:function(){a("body"),a(".cp-api-integration-form");this._ready(),b=a("#cp-create-ab-test"),c=a(".create-test-link"),f=a(".cp-abtest-modal"),d=f.find(".save-ab-test"),e=f.find("select.select2-ex-dropdown"),messageWrap=f.find(".cp-notification-message .cp-error"),c.on("click",this._create),a(document).on("click",".update-ab-test-link",this._edit),a(document).on("click",".remove-test",this._remove),a(document).on("click",".cp-stop-test-action",this._stop),a(document).on("mouseup","body:not(#cp-edit-dropdown a)",this._closeEditPanel),a(document).on("change","select[name=cp_parent_style]",function(){messageWrap.html("").removeClass("cpro-open")}),a(document).on("click",".cp-style-title a",this._editTest),b.on("submit",this._submit),e.on("change",this._updateParentDropdown),a(document).on("click",".cp-ab-edit-settings",this._editSetting),a(document).on("cp_after_ab_test_created",this._refresh_html)},_editTest:function(b){var c=a(this),d=a("#cp-ab-edit-dropdown"),e=c.closest(".cp-ab-test-row"),f=e.data("test-id"),h=e.data("test-status"),i=e.data("props");d.data("test-id",f),d.data("props",i),"2"!=h&&g._edit(b)},_closeEditPanel:function(){var b=a("#cp-ab-edit-dropdown");b.removeClass("cp-edit-show cp-edit-below cp-edit-above"),messageWrap.html("").removeClass("cpro-open"),a(".cp-ab-edit-settings").removeClass("active")},_editSetting:function(){var b=a(this),c=b.data("completed");2==c?(a("#cp-ab-edit-dropdown .update-ab-test-link").hide(),a("#cp-ab-edit-dropdown .cp-stop-test-action").hide()):(a("#cp-ab-edit-dropdown .update-ab-test-link").show(),a("#cp-ab-edit-dropdown .cp-stop-test-action").show());var d=a("#cp-ab-edit-dropdown"),e=b.closest(".cp-ab-test-row"),f=a(window),g=e.offset().top-f.scrollTop(),h=g+e.outerHeight(),i=d.outerHeight(!0),j="cp-edit-below",k=f.width()-(b.offset().left+b.outerWidth()+10),l=h-10;a(".cp-ab-edit-settings").removeClass("active"),a("html").addClass("cp-edit-action-in"),b.data("ab-test")?d.addClass("cp-edit-ab-test"):d.removeClass("cp-edit-ab-test"),b.addClass("active"),g>i&&(j="cp-edit-above",l=g-i),d.addClass(j),d.css({top:l+"px",right:k+"px"}),d.addClass("cp-edit-show");var m=e.data("test-id"),n=e.data("props");d.data("test-id",m),d.data("props",n)},_updateParentDropdown:function(){var c=e.val(),d=b.find("select[name=cp_parent_style]"),f="",g=d.val();messageWrap.html("").removeClass("cpro-open"),d.html(""),d.append('<option value="-1">'+cp_abtest.select+"</option>"),null!=c&&c.length>=2?(a(".cp-abtest-parent-wrap").show(),a.each(c,function(a,b){f=e.find("option[value="+b+"]").text(),d.append('<option value="'+b+'">'+f+"</option>")}),b.find("select[name=cp_parent_style] option[value="+g+"]").prop("selected",!0)):a(".cp-abtest-parent-wrap").hide()},_create:function(){var c=a(this).data("campaign"),h=a(this).data("settings"),i=b.find("select[name=cp_parent_style]");g.ajaxCall({action:"cp_get_remaining_popups"},function(b){if("null"!=b){var c="";a.each(b,function(a,b){c+='<option value="'+a+'">'+b+"</option>"}),e.html(c)}},function(a){console.log(a)}),a(".cp-abtest-parent-wrap").hide(),i.html(""),i.append('<option value="-1">'+cp_abtest.select+"</option>"),d.data("campaign",c),f.find(".cp-info-section").html(h),d.text(cp_abtest.create_test).data("action","cp_create_ab_test"),f.find(".cp-dashboard-modal-title").text(cp_abtest.create_new_test),b.find("#cp-test-sdate").val(""),b.find("#cp-test-edate").val(""),b.find("#test_title").val(""),e.find("option").removeAttr("selected"),b.find("input[name=cp_winner_check]").removeAttr("checked"),e.cpselect2({placeholder:cp_abtest.select_styles}),f.addClass("cp-show"),a(".cp-md-overlay").addClass("cp-show"),f.find(".cp-save-animate-container").removeClass("cp-zoomOut").addClass(" cp-animated cp-zoomIn")},_edit:function(c){c.preventDefault();var h=a("#cp-ab-edit-dropdown").data("props"),i=a("#cp-ab-edit-dropdown").data("test-id"),j="<div class='cp-abtest-block'><input type='hidden' id='cp-test-id' value='"+i+"'></div>",k=b.find("select[name=cp_parent_style]"),l="";e.html(""),g.ajaxCall({action:"cp_get_remaining_popups",test_id:i},function(c){if("null"!=c){var i="",m="";a.each(c,function(a,b){m=h.sel_styles.indexOf(parseInt(a))!=-1?'selected="selected"':"",i+='<option value="'+a+'" '+m+">"+b+"</option>"}),e.html(i),k.html(""),k.append('<option value="-1">'+cp_abtest.select+"</option>"),f.find(".cp-dashboard-modal-title").text(cp_abtest.edit_test),b.find("#cp-test-sdate").val(h.start_date),b.find("#cp-test-edate").val(h.end_date),b.find("#test_title").val(h.name),"on"==h.winner_style?b.find("input[name=cp_winner_check]").attr("checked","checked"):b.find("input[name=cp_winner_check]").removeAttr("checked"),""==h.name||b.find("#test_title").parent().hasClass("has-input")||b.find("#test_title").parent().addClass("has-input"),d.text(cp_abtest.update_test).data("action","cp_update_ab_test"),h.sel_styles.length<2?a(".cp-abtest-parent-wrap").hide():a(".cp-abtest-parent-wrap").show(),a.each(h.sel_styles,function(a,b){e.find("option[value="+b+"]").attr("selected","selected"),l=e.find("option[value="+b+"]").text(),k.append('<option value="'+b+'">'+l+"</option>")}),e.cpselect2({placeholder:cp_abtest.select_styles}),""!=h.parent_style&&k.find("option[value="+h.parent_style+"]").attr("selected","setTimeout"),f.find(".cp-style-list").after(j),f.addClass("cp-show"),a(".cp-md-overlay").addClass("cp-show"),f.find(".cp-save-animate-container").removeClass("cp-zoomOut").addClass(" cp-animated cp-zoomIn"),g._closeEditPanel()}},function(a){console.log(a)})},_submit:function(c){c.preventDefault();var e=b.find("#test_title").val(),f=b.find(".save-ab-test").data("campaign"),h=b.find("#cp-test-sdate").val(),i=b.find("#cp-test-edate").val(),j=b.find(".save-ab-test").data("action"),k=b.find("#cp-test-id").val(),l=b.find("select[name=cp_styles]").val(),m=b.find("select[name=cp_parent_style]").val(),n=b.find("input[name=cp_winner_check]:checked").length,o=cp_abtest.two_popups;return null==l?(messageWrap.html(cp_abtest.atleast_one_design).addClass("cpro-open"),!1):l.length<2?(messageWrap.html(o).addClass("cpro-open"),!1):m==-1?(messageWrap.html(cp_abtest.parent_style).addClass("cpro-open"),!1):(d.text("Saving..."),void g.ajaxCall({action:j,test_name:e,test_id:k,styles:l,campaign:f,start_date:h,end_date:i,cp_parent_style:m,cp_winner_check:0==n?"off":"on",security:a("#cp-save-ab-test-nonce").val()},g._submitCompleted,function(a){console.log(a)}))},_submitCompleted:function(c){var e=a(".cp-accordion-section-content"),f=b.find(".save-ab-test").data("action"),g=b.find("#cp-test-id").val();if("undefined"!=typeof c.data&&"undefined"!=typeof c.data.message){var h=c.data.message;if(c.data.success!==!0)return messageWrap.html(h).addClass("cpro-open"),!1;""!=c.data.html&&("cp_update_ab_test"==f?(e.find(".cp-ab-test-row[data-test-id="+g+"]").replaceWith(c.data.html),a(".no-tests").addClass("cp-hidden")):0==e.find(".cp-ab-test-row:last-child").length?(e.addClass("open"),a(".no-tests").addClass("cp-hidden"),e.find(" .cp-abtest-row").html(c.data.header_html),e.find(" .cp-abtest-row").after(c.data.html)):e.find(" .cp-ab-test-row:last-child").after(c.data.html)),setTimeout(function(){d.text(cp_abtest.saved),d.append('<span class="dashicons-yes dashicons"></span>')},300),setTimeout(function(){messageWrap.html("").removeClass("cpro-open"),a(".cp-cancel-btn").trigger("click")},600),jQuery(document).trigger("cp_after_ab_test_created",[g])}},_ready:function(){"undefined"!=typeof a().datetimepicker&&(a("#cp-test-sdate").datetimepicker({format:"DD/MM/YYYY",minDate:"now"}),a("#cp-test-edate").datetimepicker({useCurrent:!1,format:"DD/MM/YYYY"}),a("#cp-test-sdate").on("dp.change",function(b){a("#cp-test-edate").data("DateTimePicker").minDate(b.date)}),a("#cp-test-edate").on("dp.change",function(b){a("#cp-test-sdate").data("DateTimePicker").maxDate(b.date)}))},_stop:function(){if(!confirm(cp_abtest.stop_test))return!1;var b=a("#cp-ab-edit-dropdown").data("test-id"),c=2;g.ajaxCall({action:"cp_update_ab_test_status",test_id:b,status:c},function(a){location.reload()},function(a){console.log(a)})},_remove:function(){if(!confirm(cp_abtest.delete_test))return!1;var b=(a(this),a("#cp-ab-edit-dropdown").data("test-id")),c=a(".cp-ab-test-row[data-test-id="+b+"]");c.addClass("cp-delete"),g.ajaxCall({action:"cp_del_ab_test",test:b,security:a("#cp-delete-test-nonce").val()},function(b){"undefined"!=typeof b.data&&"undefined"!=typeof b.data.test_id&&(c.addClass("cp-delete-wrap"),setTimeout(function(){var b=c.closest(".cp-accordion-section-content"),d=b.find(".cp-ab-test-row").length;b.find(".cp-abtest-row");c.remove(),1==d&&(a(".no-tests").removeClass("cp-hidden"),b.removeClass("open")),g._closeEditPanel()},400))},function(a){console.log(a)})},_refresh_html:function(){g.ajaxCall({action:"cp_refresh_html",cp_nonce:cp_abtest.ajax_nonce},function(a){console.log(a)},function(a){console.log(a)})},serializeFormJSON:function(b){var c={},d=b.serializeArray();return a.each(d,function(){c[this.name]?(c[this.name].push||(c[this.name]=[c[this.name]]),c[this.name].push(this.value||"")):c[this.name]=this.value||""}),c},ajaxCall:function(b,c,d){a.ajax({data:b,action:b.action,url:cp_ajax.url,success:c,error:d,type:"POST",dataType:"JSON"})}};a(document).ready(function(){function b(b,c){var d=a.ajax({url:cp_ajax.url,method:"post",data:{action:"cp_get_ab_ga_data",test_id:b,filter:c},dataType:"json",async:!1}).responseText,e=JSON.parse(d),f=new google.visualization.DataTable;for(f.addColumn("date","X"),i=0;i<e.cols.length;i++)f.addColumn("number",e.cols[i]);for(i=0;i<e.rows.length;i++)e.rows[i][0]=new Date(e.rows[i][0]);f.addRows(e.rows);var g={title:"Analytics",width:640,height:300,hAxis:{title:"Date"},vAxis:{title:"Conversions"}},h=new google.visualization.LineChart(document.getElementById("cp_ga_chart_div"));h.draw(f,g),setTimeout(function(){a(".cp-ga-filter-wrap .cp-ga-abtest-filter").removeClass("cp-show")},200)}google.charts.load("current",{packages:["corechart"]}),a(document).on("click",".cp-ab-test-analytics",function(c){c.preventDefault();var d=a("#cp-ga-abtest-modal"),e=(a(this).data("style"),a(this).data("ab-test"));d.addClass("cp-show"),a(".cp-md-overlay").addClass("cp-show"),d.find(".cp-save-animate-container").removeClass("cp-zoomOut").addClass(" cp-animated cp-zoomIn"),a(".cp-ga-abtest-filter").data("style",e),0!=a("#cp_ga_chart_div").length&&b(e)})}),a(function(){g.init()})}(jQuery);