jQuery(document).ready(function(a){function b(){a(".wc_booking_availability_type select, .wc_booking_pricing_type select, #_wc_booking_duration_type, #_wc_booking_user_can_cancel, #_wc_booking_duration_unit, #_wc_booking_has_persons, #_wc_booking_has_resources, #_wc_booking_has_person_types").change()}function c(){a(".woocommerce_bookable_persons .woocommerce_booking_person").each(function(b,c){a(".person_menu_order",c).val(parseInt(a(c).index(".woocommerce_bookable_persons .woocommerce_booking_person"),10))})}function d(){a(".woocommerce_bookable_resources .woocommerce_booking_resource").each(function(b,c){a(".resource_menu_order",c).val(parseInt(a(c).index(".woocommerce_bookable_resources .woocommerce_booking_resource"),10))})}a("#bookings_availability, #bookings_pricing, .bookings_extension").on("change",".wc_booking_availability_type select, .wc_booking_pricing_type select",function(){var b=a(this).val(),c=a(this).closest("tr");a(c).find(".from_date, .from_day_of_week, .from_month, .from_week, .from_time, .from").hide(),a(c).find(".to_date, .to_day_of_week, .to_month, .to_week, .to_time, .to").hide(),a(".repeating-label").hide(),a(".bookings-datetime-select-to").removeClass("bookings-datetime-select-both"),a(".bookings-datetime-select-from").removeClass("bookings-datetime-select-both"),a(".bookings-to-label-row .bookings-datetimerange-second-label").hide(),"custom"==b&&a(c).find(".from_date, .to_date").show(),"months"==b&&a(c).find(".from_month, .to_month").show(),"weeks"==b&&a(c).find(".from_week, .to_week").show(),"days"==b&&a(c).find(".from_day_of_week, .to_day_of_week").show(),b.match("^time")&&(a(c).find(".from_time, .to_time").show(),"time:range"===b&&(a(c).find(".from_date, .to_date").show(),a(".repeating-label").show(),a(".bookings-datetime-select-to").addClass("bookings-datetime-select-both"),a(".bookings-datetime-select-from").addClass("bookings-datetime-select-both"),a(".bookings-to-label-row .bookings-datetimerange-second-label").show())),("persons"==b||"duration"==b||"blocks"==b)&&a(c).find(".from, .to").show()}),a("body").on("row_added",function(){a(".wc_booking_availability_type select, .wc_booking_pricing_type select").change(),a(".date-picker").datepicker({dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,showOn:"button",buttonImage:wc_bookings_writepanel_js_params.calendar_image,buttonImageOnly:!0})}),a("body").on("woocommerce-product-type-change",function(c){"booking"!==c&&(a("#_wc_booking_has_persons").removeAttr("checked"),a("#_wc_booking_has_resources").removeAttr("checked")),b()}),a("input#_virtual").change(function(){b()}),a("#_wc_booking_duration_type").change(function(){"customer"==a(this).val()?a("#min_max_duration").show():a("#min_max_duration").hide()}),a("#_wc_booking_duration_unit").change(function(){"day"===a(this).val()?(a("#enable-range-picker").show(),a("._wc_booking_apply_adjacent_buffer_field").show()):a("#enable-range-picker").hide()}),a("#_wc_booking_duration_unit").change(function(){if(a(".availability_time, ._wc_booking_first_block_time_field").show(),"month"===a(this).val())a("._wc_booking_buffer_period").hide(),a("._wc_booking_apply_adjacent_buffer_field").hide();else if("hour"!=a(this).val()&&"minute"!=a(this).val())a("._wc_booking_buffer_period").show(),a(".availability_time, ._wc_booking_first_block_time_field").hide(),a("._wc_booking_buffer_period_unit").text(wc_bookings_writepanel_js_params.i18n_days);else{var b="hour"===a(this).val()?wc_bookings_writepanel_js_params.i18n_hours:wc_bookings_writepanel_js_params.i18n_minutes;a("._wc_booking_buffer_period").show(),a("._wc_booking_apply_adjacent_buffer_field").show(),a("._wc_booking_buffer_period_unit").text(b)}}),a("#_wc_booking_user_can_cancel").change(function(){a(this).is(":checked")?a(".form-field.booking-cancel-limit").show():a(".form-field.booking-cancel-limit").hide()}),a("#_wc_booking_has_persons").change(function(){a(this).is(":checked")?a("#persons-options, .bookings_persons_tab").show():a("#persons-options, .bookings_persons_tab").hide(),a("ul.wc-tabs li:visible").eq(0).find("a").click()}),a("#_wc_booking_has_person_types").change(function(){a(this).is(":checked")?a("#persons-types").show():a("#persons-types").hide()}),a("#_wc_booking_has_resources").change(function(){a(this).is(":checked")?a(".bookings_resources_tab").show():a(".bookings_resources_tab").hide(),a("ul.wc-tabs li:visible").eq(0).find("a").click()}),b(),a("#availability_rows, #pricing_rows").sortable({items:"tr",cursor:"move",axis:"y",handle:".sort",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(a,b){b.item.css("background-color","#f6f6f6")},stop:function(a,b){b.item.removeAttr("style"),jQuery(a.target).find("tr").each(function(a,b){for(var c=jQuery(b).find('[name*="wc_booking"]'),d=0;d<c.length;d++){var e=c[d],f=jQuery(e).attr("name"),g=f.replace(/[\d+]/g,a);g!==f&&jQuery(e).attr("name",g)}})}}),a(".date-picker").datepicker({dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,showOn:"button",buttonImage:wc_bookings_writepanel_js_params.calendar_image,buttonImageOnly:!0}),a(".add_row").click(function(b){var c=a(b.target).closest("table").find("#pricing_rows tr").length,d=a(this).data("row");return d=d.replace(/bookings_cost_js_index_replace/gi,c.toString()),a(this).closest("table").find("tbody").append(d),a("body").trigger("row_added"),!1}),a("body").on("click","td.remove",function(){return a(this).closest("tr").remove(),!1}),a("#bookings_persons").on("change","input.person_name",function(){a(this).closest(".woocommerce_booking_person").find("span.person_name").text(a(this).val())}),jQuery("#bookings_persons").on("click","button.add_person",function(){jQuery(".woocommerce_bookable_persons").block({message:null});var b=jQuery(".woocommerce_booking_person").length,c={action:"woocommerce_add_bookable_person",post_id:wc_bookings_writepanel_js_params.post,loop:b,security:wc_bookings_writepanel_js_params.nonce_add_person};return jQuery.post(wc_bookings_writepanel_js_params.ajax_url,c,function(b){jQuery(".woocommerce_bookable_persons").append(b).unblock(),jQuery(".woocommerce_bookable_persons #message").hide(),a(".woocommerce_bookable_persons").sortable(e)}),!1}),jQuery("#bookings_persons").on("click","button.unlink_booking_person",function(a){a.preventDefault();var b=confirm(wc_bookings_writepanel_js_params.i18n_remove_person);if(b){var c=jQuery(this).parent().parent(),d=jQuery(this).attr("rel");if(d>0){jQuery(c).block({message:null});var e={action:"woocommerce_unlink_bookable_person",person_id:d,security:wc_bookings_writepanel_js_params.nonce_unlink_person};jQuery.post(wc_bookings_writepanel_js_params.ajax_url,e,function(a){jQuery(c).fadeOut("300",function(){jQuery(c).remove()})})}else jQuery(c).fadeOut("300",function(){jQuery(c).remove()})}return!1});var e={items:".woocommerce_booking_person",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(a,b){b.item.css("background-color","#f6f6f6")},stop:function(a,b){b.item.removeAttr("style"),c()}};a(".woocommerce_bookable_persons").sortable(e),a("#bookings_resources").on("change","input.resource_name",function(){a(this).closest(".woocommerce_booking_resource").find("span.resource_name").text(a(this).val())}),jQuery("#bookings_resources").on("click","button.add_resource",function(){var a=jQuery(".woocommerce_booking_resource").length,b=jQuery("select.add_resource_id").val(),c="";if(!b&&(c=prompt(wc_bookings_writepanel_js_params.i18n_new_resource_name),!c))return!1;jQuery(".woocommerce_bookable_resources").block({message:null});var d={action:"woocommerce_add_bookable_resource",post_id:wc_bookings_writepanel_js_params.post,loop:a,add_resource_id:b,add_resource_name:c,security:wc_bookings_writepanel_js_params.nonce_add_resource};return jQuery.post(wc_bookings_writepanel_js_params.ajax_url,d,function(a){a.error?alert(a.error):(jQuery(".woocommerce_bookable_resources").append(a.html).unblock(),jQuery(".woocommerce_bookable_resources").sortable(f),b&&jQuery(".add_resource_id").find("option[value="+b+"]").remove())}),!1}),jQuery("#bookings_resources").on("click","button.remove_booking_resource",function(a){a.preventDefault();var b=confirm(wc_bookings_writepanel_js_params.i18n_remove_resource);if(b){var c=jQuery(this).parent().parent(),d=jQuery(this).attr("rel");jQuery(c).block({message:null,overlayCSS:{background:"#fff url("+wc_bookings_writepanel_js_params.plugin_url+"/assets/images/ajax-loader.gif) no-repeat center",opacity:.6}});var e={action:"woocommerce_remove_bookable_resource",post_id:wc_bookings_writepanel_js_params.post,resource_id:d,security:wc_bookings_writepanel_js_params.nonce_delete_resource};jQuery.post(wc_bookings_writepanel_js_params.ajax_url,e,function(a){jQuery(c).fadeOut("300",function(){jQuery(c).remove()})})}return!1});var f={items:".woocommerce_booking_resource",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(a,b){b.item.css("background-color","#f6f6f6")},stop:function(a,b){b.item.removeAttr("style"),d()}};a(".woocommerce_bookable_resources").sortable(f)});
